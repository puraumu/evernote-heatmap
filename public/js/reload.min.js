// Generated by CoffeeScript 1.3.1
(function() {
  var btn, dis, node, token;

  node = function(elm, text) {
    return "<" + elm + ">" + text + "</" + elm + ">";
  };

  btn = $('button');

  dis = $('#display');

  token = null;

  dis.ajaxError(function(e, jqxhr, settings, exception) {
    var p;
    $('#cal').hide();
    p = $(node('p', ''));
    p.append(node('strong', "" + jqxhr.status));
    p.append(": " + jqxhr.responseText);
    return dis.append(p);
  });

  $.get('/estimate', function(d) {
    var est, n, state;
    state = d.state;
    n = d.number;
    $('#cal').hide();
    if (state === "OK") {
      token = true;
      est = Math.round(n / 50);
      dis.append(node('p', "You have " + n + " notes."));
      dis.append(node('p', "Estimated time: " + est + " sec"));
    }
    if (state === "NG") {
      token = false;
      dis.append(node('strong', "Developer Token is wrong."));
      dis.append(node('p', "Did you edit config.ru? Please read README file."));
    }
    if (!(state === "NG" || state === "OK")) {
      return dis.append(node('p', "Server is broken or down"));
    }
  });

  btn.on('click', function() {
    dis.append(node('p', "Processing..."));
    return $.get('/do', function(d) {
      if (d === "OK") {
        dis.append(node('p', "Done!"));
      }
      if (d === "NG" && token === false) {
        dis.append(node('strong', "Cannot authenticate to Evernote Server."));
        dis.append(node('p', "Did you edit config.ru? Please read README file."));
      }
      if (d === "NG" && token === true) {
        dis.append(node('p', "sdk is out date?"));
        return $.get('/check', function(ver) {
          return dis.append(node('p', "versionOK?: " + ver));
        });
      }
    });
  });

}).call(this);
